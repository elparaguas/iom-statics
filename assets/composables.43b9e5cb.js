import{_ as z}from"./map-pin-fill.531ed617.js";import{o as p,c as h,a as y,p as M,a3 as D,u as V,q as k,f as $,z as v,t as x,i as R,h as g,x as B,a4 as E,w as q,R as I,F,a5 as N,a6 as A,a7 as L,N as U,a8 as Y}from"./index.f7a1ecce.js";import{a as G}from"./BrForm.5ef8a548.js";const H={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24"},J=y("path",{fill:"currentColor",d:"M16.62 2.99a1.25 1.25 0 0 0-1.77 0L6.54 11.3a.996.996 0 0 0 0 1.41l8.31 8.31c.49.49 1.28.49 1.77 0s.49-1.28 0-1.77L9.38 12l7.25-7.25c.48-.48.48-1.28-.01-1.76z"},null,-1),K=[J];function P(t,o){return p(),h("svg",H,K)}var Q={name:"ic-round-arrow-back-ios",render:P};const W={class:"sticky top-0 rounded-t-lg z-1000 py-3 lg:py-3 px-4 border-b border-light-900 font-medium bg-slate-50 block <md:border-dark-400"},X={class:"flex items-center justify-between flex-nowrap"},Z={class:"flex items-center"},ee={key:0},te={class:"uppercase tracking-wider text-xs text-slate-900"},se={class:"flex items-center text-xs mt-1 text-slate-500 font-normal justify-self-end"},re=y("div",{class:"absolute w-full h-3 bg-transparent left-0 bottom-0",style:{"box-shadow":"0 14px 20px #fff"}},null,-1),me={__name:"CardNav",setup(t){const o=M(),e=D(),n=V(),r=k(()=>{const{ip:a}=e.params,{loc:c}=e.query,{name:l}=o.ips.find(({id:d})=>d==a)||{};return{ip:l,loc:c}});return(a,c)=>{const l=Q,d=E,i=z;return p(),h("nav",W,[y("div",X,[y("div",Z,[$(l,{class:"cursor-pointer text-dark-700/80 rounded-full transform hover:bg-dark-200/60 hover:text-dark-500 active:bg-dark-300/60 active:text-dark-700 active:scale-90 md:h-9 md:p-1.8 md:w-9 mr-4",onClick:c[0]||(c[0]=s=>v(n).back())}),v(o).ui.menu==="full"?(p(),h("div",ee,[y("span",te,x(v(e).meta.crumb),1)])):R("",!0)]),y("div",se,[$(d,{class:"h-5 w-5 md:mr-1.5 text-dark-500/90"}),g(" "+x(v(r).ip)+" ",1),v(e).name!=="staff-form"?(p(),B(i,{key:0,class:"ml-2 md:ml-5 md:mr-1.5 h-5 w-5 text-dark-500/90"})):R("",!0),g(" "+x(v(r).loc),1)])]),re])}}},oe=g(" Cancel "),fe={__name:"FormFooter",props:["formMode","meta","isSubmitting","submitText","submittingText"],setup(t){const o=V();return(e,n)=>{const r=G;return p(),h(F,null,[$(r,{class:"br-btn--alt br-form--submit-btn",onClick:n[0]||(n[0]=I(a=>v(o).push({name:"overview"}),["prevent"]))},{default:q(()=>[oe]),_:1}),t.formMode==="perForm"?(p(),B(r,{key:0,class:"br-btn--main br-form--submit-btn",type:"submit",disabled:t.meta.touched&&!t.meta.valid,loading:t.isSubmitting},{default:q(()=>[t.isSubmitting?(p(),h(F,{key:1},[g(x(t.submittingText),1)],64)):(p(),h(F,{key:0},[g(x(t.submitText),1)],64))]),_:1},8,["disabled","loading"])):R("",!0)],64)}}},b=M(),C={field:"fieldvisitsurvey/",staff:"staffsurvey/",benef:"benefsurvey/"},ne=t=>async({values:o,errors:e,results:n,notify:r})=>{const a=document.querySelectorAll(".br-errored");r(`This form contains <b>${a.length}</b> fields with errors`,"Cannot proceed before all fields containing errors are corrected.","danger"),setTimeout(()=>{window.scrollBy({top:a[0].getBoundingClientRect().top-150,behavior:"smooth"})},1500)},ae=(t,o)=>async(e,{setErrors:n,notify:r})=>{const a=o.currentRoute.value,{ip:c}=a.params,{loc:l}=a.query;e.ip=c,e.location=l;const d=C[t],i=await L(d,e);if(i.status===422)n(i.data);else if(i.status>=400)r(i.data,null,"danger");else if(i.status===200){const{id:s}=i.data;r("Form saved successfully.",null,"success"),b.$patch(u=>{u.surveys.push({...e,id:s,survey:t,fetched:!0})}),setTimeout(()=>{o.push({name:"overview"})},1e3)}},ce=(t,o)=>async(e,{value:n,setSuccessText:r,setError:a})=>{await N(.3);const c=o.currentRoute.value.query.id||o.currentRoute.value.params.ip,l=C[t],d=await A(l,{select:{id:c},payload:{[e]:n}});if(d.status>=400)return a(d.data);b.$patch(i=>{const s=i.surveys.find(u=>u.id==c);s&&(s[e]=n,s.fetched=!0)}),r("Field has been updated successfully")},ie=(t,o,e,n,r)=>{const a=k(()=>{const s=e.currentRoute.value;if(!s)return"";const{ip:u}=s.params;if(s.name=="staff-form")return`${s.name}-${u}`;const{loc:m}=s.query;return`${s.name}-${u}-${m}`});let c=[...o.value];const l=k(()=>{const s=e.currentRoute.value;if(!a.value)return;const{id:u}=s.query;return u||s.name==="staff-form"?"perField":"perForm"}),d=k(()=>b.isObserver?"stacked-disjoint":"stacked"),i=s=>{const u=Object.entries(s);b.isObserver&&(c=c.map(m=>{const f=s[m.name];return f===null||typeof f=="object"&&Object.keys(f).length,m}));for(let[m,f]of u)n.value[m]=f};return U(l,async s=>{if(s==="perField"){await N(.8),r.value=!0;const u=e.currentRoute.value,m=u.query.id||u.params.ip,f=b.surveys.filter(_=>_.fetched).find(_=>_.id==m);if(f)return r.value=!1,i(f);const j=C[t]+"getall/",S=await Y(j,m);if(S.status===200){const{data:_}=S;b.$patch(w=>{const T=w.surveys.findIndex(({id:O})=>O==_.id);w.surveys[T]={...w.surveys[T]||{},..._}}),i(_),r.value=!1}}},{immediate:!0}),{saveMode:l,formName:a,formType:d,fields:c}},pe=(t,o,e,n,r)=>({formControls:{onFormErrors:ne(),onFieldValid:ce(t,e),onFormValid:ae(t,e),readonly:b.isObserver},...ie(t,o,e,n,r)});export{fe as _,me as a,pe as u};
